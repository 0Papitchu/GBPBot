@echo off
REM Script pour exécuter les tests de pénétration automatisés de GBPBot
REM Usage: run_pentest.bat [--target URL] [--key API_KEY] [--output DIR] [--verbose] [--html]

setlocal enabledelayedexpansion

REM Détection du répertoire racine du projet
set "PROJECT_ROOT=%~dp0.."
cd "%PROJECT_ROOT%"

REM Vérification de l'environnement Python
where python >nul 2>&1
if %ERRORLEVEL% neq 0 (
    echo Erreur: Python n'est pas disponible. Veuillez installer Python 3.7+.
    exit /b 1
)

REM Création du répertoire pour les rapports si nécessaire
if not exist "security_reports\pentests" (
    mkdir "security_reports\pentests"
)

echo ===================================================================
echo              Tests de Pénétration Automatisés GBPBot
echo ===================================================================
echo.

REM Exécution des tests de pénétration
python "%PROJECT_ROOT%\scripts\run_pentest.py" %*

if %ERRORLEVEL% neq 0 (
    echo.
    echo ⚠️ Des vulnérabilités ont été détectées! Consultez les rapports pour plus de détails.
) else (
    echo.
    echo ✅ Aucune vulnérabilité n'a été détectée.
)

echo.
echo Rapports disponibles dans: security_reports\pentests
echo.

REM Ouvrir le répertoire des rapports
explorer "security_reports\pentests"

exit /b %ERRORLEVEL% 