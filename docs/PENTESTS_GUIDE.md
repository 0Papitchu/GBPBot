# Guide des Tests de Pénétration Automatisés GBPBot

Ce document explique comment utiliser les tests de pénétration automatisés du GBPBot pour détecter proactivement les vulnérabilités potentielles de sécurité.

## Table des Matières

1. [Introduction](#introduction)
2. [Prérequis](#prérequis)
3. [Exécution des Tests](#exécution-des-tests)
4. [Comprendre les Rapports](#comprendre-les-rapports)
5. [Types de Tests](#types-de-tests)
6. [Personnalisation](#personnalisation)
7. [Dépannage](#dépannage)
8. [FAQ](#faq)

## Introduction

Les tests de pénétration automatisés du GBPBot permettent d'évaluer la sécurité du système en simulant diverses attaques que des acteurs malveillants pourraient tenter contre l'API et les interfaces du bot. Ces tests aident à identifier et à corriger les vulnérabilités avant qu'elles ne puissent être exploitées.

Le système de tests comprend :
- Des tests d'injection (SQL, commandes, XSS)
- Des tests de méthodes HTTP invalides
- Des tests d'authentification et d'autorisation
- Des tests de traversée de chemin
- Des tests de limitation de taux (rate limiting)

## Prérequis

Pour exécuter les tests de pénétration automatisés, vous aurez besoin de :

- Python 3.7 ou supérieur
- Les dépendances du GBPBot installées
- L'API GBPBot en cours d'exécution (pour les tests complets)

## Exécution des Tests

### Sous Windows

1. Ouvrez une invite de commande ou PowerShell
2. Naviguez vers le répertoire racine du GBPBot
3. Exécutez la commande suivante :

```bat
scripts\run_pentest.bat
```

Options supplémentaires :
```bat
scripts\run_pentest.bat --target http://127.0.0.1:5000 --key votre_cle_api --html --verbose
```

### Sous Linux/macOS

1. Ouvrez un terminal
2. Naviguez vers le répertoire racine du GBPBot
3. Rendez le script exécutable (si nécessaire) :

```bash
chmod +x scripts/run_pentest.sh
```

4. Exécutez la commande suivante :

```bash
./scripts/run_pentest.sh
```

Options supplémentaires :
```bash
./scripts/run_pentest.sh --target http://127.0.0.1:5000 --key votre_cle_api --html --verbose
```

### Options disponibles

- `--target URL` : URL cible de l'API GBPBot (par défaut : valeur de la variable d'environnement GBPBOT_API_URL ou http://127.0.0.1:5000)
- `--key API_KEY` : Clé API pour l'authentification (par défaut : valeur de la variable d'environnement GBPBOT_API_KEY)
- `--output DIR` : Répertoire de sortie pour les rapports (par défaut : security_reports/pentests)
- `--verbose` : Affiche des informations détaillées pendant l'exécution
- `--specific TEST` : Exécute uniquement un test spécifique (ex: test_sql_injection)
- `--html` : Génère un rapport HTML en plus du rapport JSON

## Comprendre les Rapports

Les rapports de tests sont générés dans le répertoire `security_reports/pentests` et comprennent :

1. **Rapport JSON** : Contient les détails techniques de tous les tests exécutés
2. **Rapport HTML** (si l'option `--html` est utilisée) : Version conviviale du rapport avec mise en forme

### Structure du Rapport

Le rapport contient les sections suivantes :

- **Informations générales** : URL cible, horodatage, etc.
- **Résumé** : Nombre total de tests, tests réussis, tests échoués
- **Détails par catégorie** : Résultats détaillés pour chaque catégorie de test
- **Recommandations** : Suggestions pour résoudre les problèmes identifiés

### Interprétation des Résultats

- **Test réussi** : L'API a correctement rejeté ou géré la tentative d'attaque
- **Test échoué** : Vulnérabilité potentielle détectée qui nécessite une attention

## Types de Tests

### Injection SQL

Tests visant à détecter les vulnérabilités d'injection SQL qui pourraient permettre à un attaquant d'accéder ou de manipuler la base de données.

Exemples de payloads testés :
- `' OR '1'='1`
- `' UNION SELECT NULL, NULL, NULL --`
- `1'; DROP TABLE users; --`

### Injection de Commandes

Tests visant à détecter les vulnérabilités permettant l'exécution de commandes système non autorisées.

Exemples de payloads testés :
- `| ls -la`
- `; cat /etc/passwd`
- `$(echo vulnerable)`

### Attaques XSS (Cross-Site Scripting)

Tests visant à détecter les vulnérabilités XSS qui pourraient permettre l'injection de scripts malveillants.

Exemples de payloads testés :
- `<script>alert(1)</script>`
- `<img src=x onerror=alert(1)>`
- `javascript:alert(1)`

### Méthodes HTTP Invalides

Tests visant à s'assurer que l'API gère correctement les méthodes HTTP invalides ou non autorisées.

Méthodes testées :
- GET, POST, PUT, DELETE, PATCH, OPTIONS, HEAD, TRACE, CONNECT

### Contournement d'Authentification

Tests visant à détecter les faiblesses dans le système d'authentification.

Techniques testées :
- Absence de token d'authentification
- Token vide ou invalide
- Injection SQL dans le token
- Mauvais format d'authentification

### Traversée de Chemin (Path Traversal)

Tests visant à détecter les vulnérabilités permettant d'accéder à des fichiers système non autorisés.

Exemples de payloads testés :
- `../../../etc/passwd`
- `..\..\..\\Windows\\win.ini`
- `%2e%2e%2f%2e%2e%2fetc%2fpasswd`

### Limitation de Taux (Rate Limiting)

Tests visant à vérifier si l'API implémente des mécanismes de limitation de taux pour prévenir les attaques par déni de service.

## Personnalisation

### Ajouter des Tests Personnalisés

Vous pouvez étendre les tests de pénétration en modifiant le fichier `gbpbot/security/automated_pentest.py` :

1. Ajoutez une nouvelle méthode de test commençant par `test_` dans la classe `AutomatedPenTest`
2. Implémentez la logique de test appropriée
3. Utilisez les assertions pour valider les résultats des tests

Exemple :
```python
def test_custom_vulnerability(self) -> None:
    """Test personnalisé pour une vulnérabilité spécifique."""
    logger.info("Exécution du test personnalisé...")
    
    # Implémentez votre logique de test ici
    
    # Utilisez des assertions pour valider les résultats
    self.assertTrue(condition, "Message d'erreur")
```

### Modifier les Endpoints Testés

Si vous avez des endpoints API personnalisés, vous pouvez les ajouter aux listes d'endpoints dans les méthodes de test correspondantes.

## Dépannage

### Problèmes courants

1. **L'API n'est pas accessible**
   - Vérifiez que l'API est en cours d'exécution
   - Vérifiez que l'URL est correcte
   - Vérifiez les paramètres réseau (pare-feu, etc.)

2. **Erreurs d'authentification**
   - Vérifiez que la clé API est correcte
   - Vérifiez que la méthode d'authentification est correcte

3. **Rapports non générés**
   - Vérifiez les permissions d'écriture dans le répertoire de sortie
   - Vérifiez les logs pour les erreurs spécifiques

### Logs de Debug

Pour obtenir des informations de débogage détaillées, utilisez l'option `--verbose` :

```bash
./scripts/run_pentest.sh --verbose
```

Consultez également le fichier `pentest_results.log` pour des informations supplémentaires.

## FAQ

**Q: Les tests modifient-ils les données réelles ?**
R: Non, les tests sont conçus pour être non destructifs. Ils tentent de détecter les vulnérabilités sans modifier les données réelles.

**Q: Dois-je exécuter ces tests en production ?**
R: Il est recommandé d'exécuter ces tests dans un environnement de test ou de développement d'abord. Si vous les exécutez en production, assurez-vous de le faire pendant une période de faible activité.

**Q: À quelle fréquence dois-je exécuter ces tests ?**
R: Il est recommandé d'exécuter ces tests :
- Après chaque modification majeure du code
- Lors de l'ajout de nouveaux endpoints API
- À intervalles réguliers (par exemple, hebdomadaires) pour la surveillance continue

**Q: Que faire si des vulnérabilités sont détectées ?**
R: Analysez les rapports détaillés pour comprendre la nature de la vulnérabilité, puis corrigez le code concerné. Exécutez à nouveau les tests après correction pour vérifier que la vulnérabilité a été résolue.

**Q: Les tests peuvent-ils détecter toutes les vulnérabilités ?**
R: Non, bien que ces tests couvrent de nombreux scénarios d'attaque courants, il est impossible de garantir la détection de toutes les vulnérabilités possibles. Ces tests doivent faire partie d'une stratégie de sécurité plus large. 